<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tau Chapter Centennial Homecoming</title>
  <meta name="description" content="Register for the Tau Chapter Centennial Homecoming. Choose a sponsorship level, pay, and confirm." />
  <meta property="og:title" content="Tau Chapter Centennial Homecoming" />
  <meta property="og:description" content="Celebrate 100 years ‚Äî Brotherhood ‚Ä¢ Scholarship ‚Ä¢ Service" />
  <meta property="og:image" content="assets/tau100-4.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --pbs-royal:#19468D; --pbs-royal-dark:#13386a; --sigma-gray:#BCBEBE; }
    .card { border-radius:1rem; box-shadow:0 8px 24px rgba(0,0,0,0.08); }
    .focus-ring:focus-visible { outline:2px solid #19468D; outline-offset:2px; }
    body.dark { background:#0b1220; color:#e6edf3; }
    .tiers-scroll { display:flex; gap:1rem; overflow-x:auto; scroll-snap-type:x mandatory; padding-bottom:.25rem; }
    .tiers-scroll > label { min-width: 85%; scroll-snap-align:center; }
    @media (min-width: 768px) {
      .tiers-scroll { display:grid; overflow:visible; grid-template-columns: repeat(3, 1fr); }
      .tiers-scroll > label { min-width: auto; }
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Sticky mobile action bar -->
  <div class="fixed bottom-0 inset-x-0 z-40 md:hidden">
    <div class="mx-auto max-w-md">
      <div class="m-3 p-2 rounded-xl bg-white shadow-lg border border-[var(--sigma-gray)] flex gap-2">
        <a href="#register" class="flex-1 text-center px-4 py-3 rounded-lg bg-[var(--pbs-royal)] text-white font-semibold">Register</a>
        <a href="#donate" class="flex-1 text-center px-4 py-3 rounded-lg bg-white border font-semibold">Donate</a>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="relative bg-white/70 backdrop-blur ring-1 ring-[var(--sigma-gray)]">
    <div class="relative max-w-6xl mx-auto px-4 py-12 sm:py-16">
      <div class="flex items-center justify-between gap-4">
        <div>
          <h1 class="text-3xl sm:text-5xl font-extrabold tracking-tight">Tau Chapter Centennial Homecoming</h1>
          <p class="text-lg sm:text-xl mt-2 font-medium">Celebrating 100 Years ‚Ä¢ 1925‚Äì2025</p>
          <p id="marquee" class="mt-2 text-[var(--pbs-royal)] font-semibold">Brotherhood</p>
        </div>
        <button id="darkToggle" class="hidden sm:inline-flex px-3 py-2 rounded-lg border bg-white focus-ring" aria-label="Toggle dark mode">üåô</button>
      </div>
      <div class="mt-6 flex flex-wrap items-center gap-3">
        <a href="#register" class="px-5 py-3 bg-[var(--pbs-royal)] hover:bg-[var(--pbs-royal-dark)] text-white rounded-xl shadow font-semibold">Register</a>
        <a href="#schedule" class="px-5 py-3 bg-white text-slate-900 rounded-xl shadow border border-[var(--sigma-gray)] font-semibold">See Schedule</a>
        <a href="#donate" class="px-5 py-3 bg-white text-slate-900 rounded-xl shadow border border-[var(--sigma-gray)] font-semibold">Donate</a>
      </div>
    </div>
  </header>

  <!-- 100 Years of Tau -->
  <section id="timeline" class="max-w-6xl mx-auto px-4 py-12">
    <h2 class="text-2xl sm:text-3xl font-extrabold">100 Years of Tau Chapter</h2>
    <div class="mt-6 grid md:grid-cols-3 gap-6">
      <figure class="card bg-white rounded-2xl p-6 ring-1 ring-[var(--sigma-gray)]">
        <img src="assets/tau100-1.jpg" loading="lazy" alt="Brotherhood" class="rounded-xl w-full h-48 object-cover" width="640" height="384" />
        <figcaption class="mt-3 text-sm text-slate-700"><strong>Brotherhood</strong> ‚Äî A bond unlike any other.</figcaption>
      </figure>
      <figure class="card bg-white rounded-2xl p-6 ring-1 ring-[var(--sigma-gray)]">
        <img src="assets/tau100-3.jpg" loading="lazy" alt="Scholarship" class="rounded-xl w-full h-48 object-cover" width="640" height="384" />
        <figcaption class="mt-3 text-sm text-slate-700"><strong>Scholarship</strong> ‚Äî A century of academic success.</figcaption>
      </figure>
      <figure class="card bg-white rounded-2xl p-6 ring-1 ring-[var(--sigma-gray)]">
        <img src="assets/charter members.jpg" loading="lazy" alt="Service" class="rounded-xl w-full h-48 object-cover" width="640" height="384" />
        <figcaption class="mt-3 text-sm text-slate-700"><strong>Service</strong> ‚Äî Committed to servicing Louisville since 1925.</figcaption>
      </figure>
    </div>
  </section>

  <!-- SCHEDULE -->
  <section id="schedule" class="max-w-6xl mx-auto px-4 py-12">
    <h2 class="text-2xl sm:text-3xl font-extrabold">Weekend Schedule</h2>
    <div class="mt-6 grid md:grid-cols-3 gap-6">
      <!-- Friday Social -->
      <div class="card bg-white rounded-2xl p-6 ring-1 ring-[var(--sigma-gray)]">
        <h3 class="text-xl font-bold">Friday, October 24 ‚Ä¢ Social Gathering</h3>
        <ul class="mt-3 text-sm text-slate-700 list-disc list-inside">
          <li>Time: 5:00‚Äì6:30 PM (near Brown Theater, TBA)</li>
          <li>We‚Äôll enter the Stepshow together</li>
        </ul>
        <div class="mt-2 text-sm">
          <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Tau%20Chapter%20Social%20Gathering&dates=20250919T220000Z/20250919T233000Z&details=Meet%20near%20Brown%20Theater%2C%20enter%20Stepshow%20together&location=Brown%20Theater%20area"
             target="_blank" class="underline text-[var(--pbs-royal)]">Add to Google Calendar</a>
        </div>
      </div>

      <!-- Friday Stepshow -->
      <div class="card bg-white rounded-2xl p-6 ring-1 ring-[var(--sigma-gray)]">
        <h3 class="text-xl font-bold">Friday, October 24 ‚Ä¢ Homecoming Stepshow</h3>
        <div class="mt-2 text-sm">
  <a href="https://tickets.kentuckyperformingarts.org/25109"
     target="_blank" class="underline text-[var(--pbs-royal)] font-semibold">
    Buy Tickets via Kentucky Performing Arts
  </a>
  <p class="mt-1 text-gray-600 italic">
    Use promo code <strong>MIGHTY25</strong> at checkout for discounted tickets.
  </p>
</div>
<img src="assets/tau100-4.jpg" loading="lazy" alt="Stepshow" class="rounded-xl w-full h-40 object-cover mt-2" width="640" height="320" />
        <ul class="mt-3 text-sm text-slate-700 list-disc list-inside">
          <li>Time: 7:00 PM</li>
          <li>Venue: Brown Theater (Kentucky Performing Arts)</li>
        </ul>
        <div class="mt-2 text-sm">
          <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Tau%20Chapter%20Homecoming%20Stepshow&dates=20250919T230000Z/20250920T010000Z&details=Official%20stepshow%20at%20Brown%20Theater&location=Brown%20Theater%2C%20315%20W%20Broadway%2C%20Louisville%2C%20KY"
             target="_blank" class="underline text-[var(--pbs-royal)]">Add to Google Calendar</a>
        </div>
      </div>

      <!-- Saturday Tailgate -->
      <div class="card bg-white rounded-2xl p-6 ring-1 ring-[var(--sigma-gray)]">
        <h3 class="text-xl font-bold">Saturday, October 25 ‚Ä¢ Tailgate</h3>
        <div class="flex items-center gap-3 mt-2">
          <img src="assets/uofl-bc.jpg" alt="UofL vs Boston College" loading="lazy" class="h-10 object-contain" height="40" />
        </div>
        <ul class="mt-3 text-sm text-slate-700 list-disc list-inside">
          <li>Time: 12:00‚Äì3:00 PM</li>
          <li>Location: TBA (near stadium)</li>
          <li>Football game ticket not included</li>
        </ul>
        <div class="mt-2 text-sm">
          <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Tau%20Chapter%20Tailgate&dates=20250920T170000Z/20250920T200000Z&details=Tailgate%20near%20stadium&location=Louisville%20KY"
             target="_blank" class="underline text-[var(--pbs-royal)]">Add to Google Calendar</a>
        </div>
      </div>
    </div>
  </section>

  <!-- SUPPORT / DONATE -->
  <section id="donate" class="max-w-6xl mx-auto px-4 py-12">
    <h2 class="text-2xl sm:text-3xl font-extrabold">Support Tau Chapter</h2>
    <p class="text-slate-600 mt-2">Remaining proceeds support current undergraduate brothers.</p>
    <div class="mt-4 flex flex-wrap items-center gap-3">
      <a href="https://cash.app/$UofLSigmas" target="_blank" class="px-5 py-3 bg-white rounded-xl border font-semibold shadow">Donate via Cash App</a>
    </div>
  </section>

  <!-- REGISTRATION -->
  <section id="register" class="max-w-6xl mx-auto px-4 py-12">
    <div class="bg-white rounded-2xl p-6 ring-1 ring-[var(--sigma-gray)] card">
      <h2 class="text-2xl sm:text-3xl font-extrabold">Register</h2>
      <p class="text-slate-600 mt-2">Choose a sponsorship level, complete your info, then pay via Cash App or PayPal and confirm payment.</p>

      <!-- Sponsorship tiers -->
      <div id="tiers" class="mt-6 tiers-scroll">
        <!-- $100 -->
        <label class="group block rounded-2xl border-2 border-[var(--sigma-gray)] p-4 cursor-pointer hover:border-[var(--pbs-royal)] bg-white">
          <div class="flex items-start justify-between gap-2">
            <div>
              <div class="text-xl font-extrabold">$100</div>
              <div class="font-semibold">Centennial Sponsorship</div>
              <div class="mt-1 text-sm text-slate-600 flex flex-col gap-1">
                <span>‚≠ê Special recognition from TAU</span>
                <span>üçî Tailgate included</span>
                <span>üéΩ T-shirt included</span>
              </div>
            </div>
            <input type="radio" name="tier" value="100|Centennial Sponsorship" class="mt-1 h-5 w-5" checked />
          </div>
          <div class="mt-2 inline-flex items-center text-xs font-semibold text-white bg-[var(--pbs-royal)] px-2 py-1 rounded">Most Impactful</div>
        </label>

        <!-- $50 -->
        <label class="group block rounded-2xl border-2 border-[var(--sigma-gray)] p-4 cursor-pointer hover:border-[var(--pbs-royal)] bg-white">
          <div class="flex items-start justify-between gap-2">
            <div>
              <div class="text-xl font-extrabold">$50</div>
              <div class="font-semibold">Tailgate + T-shirt</div>
              <div class="mt-1 text-sm text-slate-600 flex flex-col gap-1">
                <span>üçî Tailgate included</span>
                <span>üéΩ T-shirt included</span>
              </div>
            </div>
            <input type="radio" name="tier" value="50|Tailgate + T-shirt" class="mt-1 h-5 w-5" />
          </div>
        </label>

        <!-- $25 -->
        <label class="group block rounded-2xl border-2 border-[var(--sigma-gray)] p-4 cursor-pointer hover:border-[var(--pbs-royal)] bg-white">
          <div class="flex items-start justify-between gap-2">
            <div>
              <div class="text-xl font-extrabold">$25</div>
              <div class="font-semibold">Tailgate only</div>
              <div class="mt-1 text-sm text-slate-600 flex flex-col gap-1">
                <span>üçî Tailgate included</span>
                <span>üéü Football game ticket not included</span>
              </div>
            </div>
            <input type="radio" name="tier" value="25|Tailgate only" class="mt-1 h-5 w-5" />
          </div>
        </label>
      </div>

      <form id="regForm" class="mt-6 grid md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium">Full Name</label>
          <input name="name" required class="mt-1 w-full rounded-xl border-[var(--sigma-gray)] focus:outline-none focus:ring-2 focus:ring-[var(--pbs-royal)]" />
        </div>
        <div>
          <label class="block text-sm font-medium">Email</label>
          <input type="email" name="email" required class="mt-1 w-full rounded-xl border-[var(--sigma-gray)] focus:outline-none focus:ring-2 focus:ring-[var(--pbs-royal)]" />
        </div>
        <div>
          <label class="block text-sm font-medium">Phone</label>
          <input type="tel" name="phone" required class="mt-1 w-full rounded-xl border-[var(--sigma-gray)] focus:outline-none focus:ring-2 focus:ring-[var(--pbs-royal)]" />
        </div>
        <div>
          <label class="block text-sm font-medium">Year Joined the Fraternity</label>
          <input type="number" name="yearJoined" required min="1900" max="2100" class="mt-1 w-full rounded-xl border-[var(--sigma-gray)] focus:outline-none focus:ring-2 focus:ring-[var(--pbs-royal)]" />
        </div>
        <div>
          <label class="block text-sm font-medium">T-Shirt Size</label>
          <select name="tshirtSize" required class="mt-1 w-full rounded-xl border-[var(--sigma-gray)] focus:outline-none focus:ring-2 focus:ring-[var(--pbs-royal)]">
            <option value="M">M</option><option value="L">L</option><option value="XL">XL</option>
            <option value="2XL">2XL</option><option value="3XL">3XL</option><option value="4XL">4XL</option><option value="5XL">5XL</option>
          </select>
        </div>

        <!-- Honeypot -->
        <div class="hidden" style="display:none!important;">
          <label>Website</label>
          <input name="website" tabindex="-1" autocomplete="off" />
        </div>

        <!-- Public roster opt-in -->
        <label class="flex items-center gap-2 md:col-span-2 text-sm">
          <input type="checkbox" name="optInPublic" class="rounded" checked />
          I‚Äôm OK with my name appearing on the public ‚ÄúRegistered Attendees‚Äù list.
        </label>

        <!-- Dynamic selection summary -->
        <p id="tierSummary" class="md:col-span-2 text-sm text-slate-700">Selected: <strong>$100 ‚Äì Centennial Sponsorship</strong></p>

        <div class="md:col-span-2 flex items-center justify-between gap-4">
          <div class="text-sm text-slate-600">Remaining proceeds support current undergraduate brothers.</div>
          <button type="submit" id="submitBtn" class="px-5 py-3 bg-[var(--pbs-royal)] hover:bg-[var(--pbs-royal-dark)] text-white rounded-xl shadow font-semibold">Continue</button>
        </div>
        <p id="formMsg" class="md:col-span-2 text-sm text-slate-600"></p>
      </form>

      <!-- Confirmation panel (shown after submit) -->
      <div id="confirmPanel" class="hidden mt-6 rounded-xl border p-4 bg-slate-50">
        <h3 class="font-bold">Last Step: Send your payment, then confirm</h3>
        <p class="text-sm mt-2">Please send <span id="payAmount" class="font-semibold">$100</span> via Cash App or PayPal, then click <em>Confirm Payment</em> below.</p>
        <ul class="mt-2 list-disc list-inside text-sm">
          <li>Cash App: <a href="https://cash.app/$UofLSigmas" target="_blank" class="underline">cash.app/$UofLSigmas</a></li>
          <li>PayPal: <a href="https://paypal.me/your-handle" target="_blank" class="underline">paypal.me/your-handle</a></li>
        </ul>
        <div class="mt-3 text-sm">
          Your payment code: <code id="paymentCode" class="px-2 py-1 bg-white rounded border">TBD</code>
          <button id="copyCode" class="ml-2 px-2 py-1 text-xs border rounded bg-white">Copy</button>
        
<a id="payVenmo" class="btn" target="_blank" rel="noopener">Pay with Venmo</a>

<a id="payCashApp" class="btn" target="_blank" rel="noopener">Pay with Cash App</a>

<a id="payPayPal" class="btn" target="_blank" rel="noopener">Pay with PayPal</a>

<label style="display:flex;gap:8px;align-items:center;margin:8px 0"><input id="paidCheck" type="checkbox"><span>I paid</span></label>
</div>
        <div class="mt-3 sticky bottom-2">
          <a id="confirmLink" href="#" class="px-4 py-2 rounded-lg bg-[var(--pbs-royal)] text-white font-semibold inline-block">Confirm Payment</a>
        </div>
        <p class="text-xs text-slate-500 mt-2">If you close this page, you can use the emailed link (if enabled) to confirm later.</p>
      </div>
    </div>
  </section>

  <!-- ROSTER -->
  <section id="roster" class="max-w-6xl mx-auto px-4 py-12">
    <div class="flex items-center justify-between">
      <h2 class="text-2xl sm:text-3xl font-extrabold">Registered Attendees</h2>
      <button id="refreshBtn" class="px-4 py-2 rounded-xl border bg-white shadow text-sm">Refresh</button>
    </div>
    <div id="rosterWrap" class="mt-6 grid md:grid-cols-2 gap-6"></div>
  </section>

  <!-- Footer micro-nav + Donate + QR + Admin -->
  <footer class="border-t">
    <div class="max-w-6xl mx-auto px-4 py-10 text-sm">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <nav class="flex gap-4">
          <a href="#register" class="underline">Register</a>
          <a href="#schedule" class="underline">Schedule</a>
          <a href="#donate" class="underline">Donate</a>
          <a href="#roster" class="underline">Roster</a>
        </nav>
        <div class="flex items-center gap-3">
          <a href="https://cash.app/$UofLSigmas" target="_blank" class="px-3 py-2 rounded-lg border bg-white">Donate via Cash App</a>
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=110x110&data=https%3A%2F%2Fcash.app%2F%24UofLSigmas" alt="Donate QR" class="w-14 h-14 rounded" />
        </div>
      </div>

      <details class="mt-6">
        <summary class="cursor-pointer font-semibold">Admin</summary>
        <div class="mt-3 flex flex-wrap items-center gap-3">
          <input id="adminKey" type="password" placeholder="Passcode" class="rounded border px-3 py-2" />
          <button id="csvBtn" class="px-3 py-2 rounded border bg-white">Download CSV</button>
          <button id="totalsBtn" class="px-3 py-2 rounded border bg-white">Totals</button>
          <button id="pendingBtn" class="px-3 py-2 rounded border bg-white">Load Pending</button>
        </div>
        <div id="pendingList" class="mt-4 grid md:grid-cols-2 gap-4"></div>
        <pre id="totalsOut" class="mt-3 text-xs text-slate-600"></pre>
      </details>

      <div class="mt-6 text-slate-500">¬© 2025 Tau Chapter Centennial Homecoming</div>
    </div>
  </footer>

  <script>
    // Dark mode toggle with persistence
    const darkToggle=document.getElementById('darkToggle');
    if(localStorage.getItem('tau.dark')==='1'){ document.body.classList.add('dark'); }
    darkToggle?.addEventListener('click',()=>{
      document.body.classList.toggle('dark');
      localStorage.setItem('tau.dark', document.body.classList.contains('dark') ? '1' : '0');
    });

    // Marquee
    (function(){ const phrases=["Brotherhood","Scholarship","Service"]; let i=0;
      setInterval(()=>{ i=(i+1)%phrases.length; document.getElementById('marquee').textContent=phrases[i]; }, 2500);
    })();

    // Tier summary + amount binding
    function currentTier(){ const c=document.querySelector('input[name="tier"]:checked'); if(!c) return {amount:100,name:"Centennial Sponsorship"}; const [a,n]=c.value.split('|'); return {amount:Number(a), name:n}; }
    function updateSummary(){ const t=currentTier(); document.getElementById('tierSummary').innerHTML='Selected: <strong>$'+t.amount+' ‚Äì '+t.name+'</strong>'; }
    document.querySelectorAll('input[name="tier"]').forEach(r=>r.addEventListener('change',updateSummary)); updateSummary();

    // Roster helpers
    const rosterWrap=document.getElementById('rosterWrap'); const refreshBtn=document.getElementById('refreshBtn');
    function groupByDecade(list){ const g={}; for(const r of list){ if(r.optInPublic===false) continue; const y=Number(r.yearJoined||0); const d=Math.floor(y/10)*10; const k=d+'s'; g[k]=g[k]||{}; g[k][y]=g[k][y]||[]; g[k][y].push(r);} return g; }
    function renderRoster(list){ const g=groupByDecade(list); const decades=Object.keys(g).sort((a,b)=>parseInt(b)-parseInt(a)); rosterWrap.innerHTML=''; if(!decades.length){ rosterWrap.innerHTML='<div class="text-slate-600">No registrations yet.</div>'; return;} for(const d of decades){ const years=Object.keys(g[d]).map(Number).sort((a,b)=>a-b); const col=document.createElement('div'); col.className='bg-white rounded-2xl p-6 ring-1 ring-[var(--sigma-gray)] card'; col.innerHTML='<h3 class="text-xl font-bold">'+d+'</h3>'; for(const y of years){ const items=g[d][y].sort((a,b)=>a.name.localeCompare(b.name)).map(p=>'<li class="py-1 flex gap-2 items-center"><span class="font-medium">'+p.name+'</span> <span class="text-xs text-slate-500">('+y+(p.tshirtSize?', '+p.tshirtSize:'')+')</span></li>').join(''); col.insertAdjacentHTML('beforeend','<div class="mt-4"><div class="text-sm font-semibold">'+y+'</div><ul class="mt-1 text-sm">'+items+'</ul></div>'); } rosterWrap.appendChild(col);} }
    async function loadRoster(){ rosterWrap.innerHTML='<div class="text-slate-600">Loading roster‚Ä¶</div>'; try{ const r=await fetch('/.netlify/functions/list_registrants'); const j=await r.json(); renderRoster(j.registrants||[]);} catch(e){ rosterWrap.innerHTML='<div class="text-slate-600">Unable to load roster.</div>'; } }
    refreshBtn.addEventListener('click',loadRoster); loadRoster();

    // Form submit -> create pending & show confirm
    const form=document.getElementById('regForm'); const formMsg=document.getElementById('formMsg');
    const confirmPanel=document.getElementById('confirmPanel'); const payAmount=document.getElementById('payAmount');
    const paymentCodeEl=document.getElementById('paymentCode'); const copyCode=document.getElementById('copyCode'); const confirmLink=document.getElementById('confirmLink');
    copyCode.addEventListener('click',()=>{ const code=paymentCodeEl.textContent; navigator.clipboard.writeText(code); copyCode.textContent='Copied'; setTimeout(()=>copyCode.textContent='Copy',1200); });
    form.addEventListener('submit', async (e)=>{
      e.preventDefault(); formMsg.textContent=''; const t=currentTier(); payAmount.textContent='$'+t.amount; const data=new FormData(form);
      const payload={ name:data.get('name'), email:data.get('email'), phone:data.get('phone'), yearJoined:Number(data.get('yearJoined')), tshirtSize:data.get('tshirtSize'), website:data.get('website'), optInPublic:data.get('optInPublic')==='on', packageName:t.name, packageAmount:t.amount };
      try{ const r=await fetch('/.netlify/functions/submit_manual_registration',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)}); if(!r.ok) throw new Error('submit failed'); const j=await r.json(); paymentCodeEl.textContent=j.paymentCode||'UNKNOWN'; confirmLink.href=j.confirmUrl||'#'; confirmPanel.classList.remove('hidden'); form.scrollIntoView({behavior:'smooth', block:'center'});} catch(err){ formMsg.textContent='Something went wrong. Please try again.'; }
    });

    // Admin footer
    const adminKey=()=>document.getElementById('adminKey')?.value||''; const csvBtn=document.getElementById('csvBtn'); const totalsBtn=document.getElementById('totalsBtn'); const pendingBtn=document.getElementById('pendingBtn'); const pendingList=document.getElementById('pendingList'); const totalsOut=document.getElementById('totalsOut');
    csvBtn.addEventListener('click', async ()=>{ const r=await fetch('/.netlify/functions/export_csv', { headers:{'x-admin-key':adminKey()} }); if(!r.ok){ alert('Unauthorized or error'); return; } const blob=await r.blob(); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='registrants.csv'; a.click(); URL.revokeObjectURL(url); });
    totalsBtn.addEventListener('click', async ()=>{ totalsOut.textContent='Calculating‚Ä¶'; const r=await fetch('/.netlify/functions/list_registrants'); const j=await r.json(); const byAmt={}; let sum=0; (j.registrants||[]).forEach(x=>{ const a=Number(x.packageAmount||0); byAmt[a]=(byAmt[a]||0)+1; sum+=a; }); let lines=[]; Object.keys(byAmt).sort((a,b)=>Number(b)-Number(a)).forEach(k=> lines.push(`${byAmt[k]} √ó $${k}`)); lines.push(`Total: $${sum}`); totalsOut.textContent=lines.join(' | '); });
    pendingBtn.addEventListener('click', async ()=>{ pendingList.innerHTML='Loading‚Ä¶'; const r=await fetch('/.netlify/functions/list_pending', { headers:{'x-admin-key':adminKey()} }); if(!r.ok){ pendingList.innerHTML='Unauthorized or error'; return; } const j=await r.json(); pendingList.innerHTML=(j.items||[]).map(p=>`<div class="rounded-xl border p-3 bg-white"><div class="font-semibold">${p.name} <span class="text-xs text-slate-500">(${p.packageAmount ? '$'+p.packageAmount : ''} ${p.packageName||''})</span></div><div class="text-xs text-slate-600">${p.email} ‚Ä¢ ${p.phone}</div><div class="text-xs text-slate-600">Year ${p.yearJoined} ‚Ä¢ Size ${p.tshirtSize||''}</div><div class="mt-2 flex gap-2"><button onclick="approve('${p.key}')" class="px-3 py-1 rounded border bg-white text-sm">Approve</button><button onclick="deny('${p.key}')" class="px-3 py-1 rounded border bg-white text-sm">Deny</button></div></div>`).join(''); });
    window.approve = async (key)=>{ const r=await fetch('/.netlify/functions/approve_pending', { method:'POST', headers:{'Content-Type':'application/json','x-admin-key':adminKey()}, body:JSON.stringify({key}) }); if(r.ok){ alert('Approved'); loadRoster(); pendingBtn.click(); } else alert('Error'); };
    window.deny = async (key)=>{ const r=await fetch('/.netlify/functions/deny_pending', { method:'POST', headers:{'Content-Type':'application/json','x-admin-key':adminKey()}, body:JSON.stringify({key}) }); if(r.ok){ alert('Removed'); pendingBtn.click(); } else alert('Error'); };
  </script>
  <script src="assets/js/submit-handler.js"></script>
</body>
</html>
